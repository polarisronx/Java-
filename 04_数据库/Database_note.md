# 存储引擎

## InnoDB

逻辑存储结构

每个innoDB引擎的表都会对应有一个.ibd 表空间文件。早期是有frm来记录表的结构的，后来换成了sdi文件（8.0），但sdi文件又融进.ibd文件中了。

表空间 tablespace --> 段 segment --> 区 extent (固定大小 1M) --> 页 page(固定大小 16k) --> 行 row 

# 2 索引

## 2.1 索引的分类

聚簇索引

二级索引

回表查询

## 2.2 索引结构

每个节点都存储在数据页（块）中

## 2.3 SQL性能优化

性能优化主要是优化查询，而优化查询主要是优化引擎

1. SQL执行频率： show  global status like 'Com\_\_\_\___'：检查当前数据库crud哪个执行的更多

2. 慢查询日志：要优化哪条SQL语句 慢查询日志会筛选出执行时间超过了指定参数的所有SQL语句

3. profile详情：了解每条SQL语句花费了多少时间，该条SQL语句的时间都花在哪个阶段上了

4. explain执行计划：查看该条SQL语句是如何执行的  

   不同字段的含义：  

   - id: select 查询的序列号，表示查询中执行 select 子句或者操作表的顺序（id相同，执行顺序从上到下；id不同，值越大越先执行）
   - select_type: 表示 SELECT 的类型，常见取值有 SIMPLE（简单表，即不适用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等
   - type：表示连接类型，性能由好到差的连接类型为 NULL（查询的时候没用到表，一般达不到）、system（访问系统表）、const（访问主键或唯一字段）、eq_ref、ref（非唯一性的索引字段）、range、index（用到了索引，但基本每个索引都遍历）、all（全表扫描）
   - possible_key：可能应用在这张表上的索引，一个或多个
   - Key：实际使用的索引，如果为 NULL，则没有使用索引
   - Key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好
   - rows：MySQL认为必须要执行的行数，在InnoDB引擎的表中，是一个估计值，可能并不总是准确的
   - filtered：表示返回结果的行数占需读取行数的百分比，filtered的值越大越好